version: '3.8'

networks:
  homelab:
    external: true

services:
{% if home_assistant_enabled %}
  homeassistant:
    image: ghcr.io/home-assistant/home-assistant:stable
    container_name: homeassistant
    volumes:
      - "{{ home_assistant_config_dir }}:/config"
      - "{{ home_assistant_ssl_dir }}:/ssl"
      - /etc/localtime:/etc/localtime:ro
    restart: unless-stopped
    privileged: true
    network_mode: host
    environment:
      - TZ={{ automation_timezone }}
{% endif %}

{% if zigbee2mqtt_enabled %}
  zigbee2mqtt:
    image: koenkk/zigbee2mqtt:latest
    container_name: zigbee2mqtt
    volumes:
      - "{{ zigbee2mqtt_data_dir }}:/app/data"
      - /dev:/dev
    ports:
      - "{{ zigbee2mqtt_port }}:8080"
    environment:
      - TZ={{ automation_timezone }}
    restart: unless-stopped
    privileged: true
    devices:
      - /dev/ttyACM0:/dev/ttyACM0
    networks:
      - homelab
    depends_on:
      - mosquitto
{% endif %}

{% if node_red_enabled %}
  nodered:
    image: nodered/node-red:latest
    container_name: nodered
    ports:
      - "{{ node_red_port }}:1880"
    volumes:
      - "{{ docker_data_root }}/nodered:/data"
    restart: unless-stopped
    networks:
      - homelab
{% endif %}

{% if n8n_enabled %}
  n8n:
    image: n8nio/n8n:latest
    container_name: n8n
    ports:
      - "{{ n8n_port }}:5678"
    volumes:
      - "{{ docker_data_root }}/n8n:/home/node/.n8n"
    restart: unless-stopped
    networks:
      - homelab
{% endif %} 