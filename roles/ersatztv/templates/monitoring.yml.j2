# ErsatzTV Monitoring Configuration
# Generated by Ansible - Do not edit manually

# Prometheus Configuration
prometheus:
  enabled: {{ ersatztv_prometheus_enabled | lower }}
  port: {{ ersatztv_prometheus_port | default(9090) }}
  path: {{ ersatztv_prometheus_path | default('/metrics') }}
  scrape_interval: {{ ersatztv_prometheus_scrape_interval | default('30s') }}
  scrape_timeout: {{ ersatztv_prometheus_scrape_timeout | default('10s') }}

# Grafana Configuration
grafana:
  enabled: {{ ersatztv_grafana_enabled | lower }}
  dashboard:
    title: "ErsatzTV Dashboard"
    tags: ["ersatztv", "media", "streaming"]
    refresh: "30s"
  datasource:
    name: "ErsatzTV"
    type: "prometheus"
    url: "http://prometheus:9090"

# Loki Configuration
loki:
  enabled: {{ ersatztv_loki_enabled | lower }}
  job: "media"
  service: "ersatztv"
  labels:
    - "app=ersatztv"
    - "service=media"

# Telegraf Configuration
telegraf:
  enabled: {{ ersatztv_telegraf_enabled | lower }}
  interval: {{ ersatztv_telegraf_interval | default('60s') }}
  inputs:
    - http_response:
        urls:
          - "http://localhost:{{ ersatztv_port }}/api/health"
        response_timeout: "10s"
        method: "GET"
    - docker:
        endpoint: "unix:///var/run/docker.sock"
        container_names:
          - "{{ ersatztv_container_name }}"
  outputs:
    - prometheus_client:
        listen: ":{{ ersatztv_telegraf_prometheus_port | default(9273) }}"

# Health Check Configuration
health_check:
  enabled: {{ ersatztv_health_check_enabled | lower }}
  interval: {{ ersatztv_health_check_interval | default('5m') }}
  timeout: {{ ersatztv_health_check_timeout | default('30s') }}
  retries: {{ ersatztv_health_check_retries | default(3) }}
  endpoints:
    - "http://localhost:{{ ersatztv_port }}/api/health"
    - "http://localhost:{{ ersatztv_port }}/api/status"
    - "http://localhost:{{ ersatztv_port }}/api/channels"

# Performance Monitoring
performance:
  enabled: {{ ersatztv_performance_monitoring_enabled | lower }}
  metrics:
    - cpu_usage
    - memory_usage
    - disk_usage
    - network_io
    - transcoding_performance
    - streaming_performance
    - active_streams
    - channel_count
    - collection_count
    - media_count

# Alerting Configuration
alerting:
  enabled: {{ ersatztv_alerting_enabled | lower }}
  rules:
    - name: "ErsatzTV Service Down"
      condition: "ersatztv_up == 0"
      severity: "critical"
      duration: "1m"
    - name: "High CPU Usage"
      condition: "ersatztv_cpu_usage > 80"
      severity: "warning"
      duration: "5m"
    - name: "High Memory Usage"
      condition: "ersatztv_memory_usage > 85"
      severity: "warning"
      duration: "5m"
    - name: "No Active Streams"
      condition: "ersatztv_active_streams == 0"
      severity: "info"
      duration: "10m"

# Log Monitoring
log_monitoring:
  enabled: {{ ersatztv_log_monitoring_enabled | lower }}
  patterns:
    - pattern: "error"
      severity: "error"
    - pattern: "exception"
      severity: "error"
    - pattern: "warning"
      severity: "warning"
    - pattern: "failed"
      severity: "error"
    - pattern: "timeout"
      severity: "warning" 