---
- name: Check Samba service status
  ansible.builtin.systemd:
    name: samba
  register: samba_status
  failed_when: not samba_status.status.ActiveState == 'active'

- name: Check Syncthing service status
  ansible.builtin.systemd:
    name: syncthing
  register: syncthing_status
  failed_when: not syncthing_status.status.ActiveState == 'active'

- name: Check Nextcloud service status
  ansible.builtin.systemd:
    name: nextcloud
  register: nextcloud_status
  failed_when: not nextcloud_status.status.ActiveState == 'active'

- name: Check Samba port 445
  ansible.builtin.wait_for:
    port: 445
    state: started
    timeout: 5

- name: Check Syncthing port 8384
  ansible.builtin.wait_for:
    port: 8384
    state: started
    timeout: 5

- name: Check Nextcloud port 443
  ansible.builtin.wait_for:
    port: 443
    state: started
    timeout: 5

- name: Validate homepage integration
  ansible.builtin.stat:
    path: "{{ config_dir }}/homepage-services-storage.yml"
  register: homepage_services_file
  failed_when: not homepage_services_file.stat.exists
