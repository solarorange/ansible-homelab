{
  "rollback_id": "{{ rollback_timestamp }}",
  "deployment_info": {
    "timestamp": "{{ ansible_date_time.iso8601 }}",
    "deployment_id": "{{ ansible_date_time.epoch }}",
    "ansible_version": "{{ ansible_version.full }}",
    "target_host": "{{ inventory_hostname }}",
    "domain": "{{ domain }}"
  },
  "system_info": {
    "architecture": "{{ ansible_architecture }}",
    "os_family": "{{ ansible_os_family }}",
    "os_version": "{{ ansible_os_version }}",
    "kernel": "{{ ansible_kernel }}",
    "cpu_cores": "{{ ansible_processor_cores }}",
    "memory_total": "{{ ansible_memtotal_mb }}MB",
    "disk_available": "{{ available_disk_gb.stdout }}GB"
  },
  "network_info": {
    "ip_address": "{{ ansible_default_ipv4.address }}",
    "hostname": "{{ ansible_hostname }}",
    "domain": "{{ domain }}"
  },
  "docker_info": {
    "docker_version": "{{ docker_version.stdout }}",
    "docker_storage_driver": "{{ docker_storage_driver.stdout }}",
    "docker_root": "{{ docker_root }}"
  },
  "enabled_services": {
    "security_enabled": {{ security_enabled | default(false) | tojson }},
    "databases_enabled": {{ databases_enabled | default(false) | tojson }},
    "storage_enabled": {{ storage_enabled | default(false) | tojson }},
    "logging_enabled": {{ logging_enabled | default(false) | tojson }},
    "media_enabled": {{ media_enabled | default(false) | tojson }},
    "automation_enabled": {{ automation_enabled | default(false) | tojson }},
    "utilities_enabled": {{ utilities_enabled | default(false) | tojson }},
    "paperless_ngx_enabled": {{ paperless_ngx_enabled | default(false) | tojson }},
    "fing_enabled": {{ fing_enabled | default(false) | tojson }}
  },
  "configuration": {
    "docker_dir": "{{ docker_dir }}",
    "data_dir": "{{ data_dir }}",
    "config_dir": "{{ config_dir }}",
    "backup_dir": "{{ backup_dir }}",
    "logs_dir": "{{ logs_dir }}"
  },
  "backup_files": {
    "config_backup": "{{ backup_dir }}/rollback/config-backup-{{ rollback_timestamp }}.tar.gz",
    "database_backups": []
  },
  "rollback_instructions": {
    "description": "Rollback point created before deployment",
    "rollback_script": "{{ backup_dir }}/rollback/rollback-execute.sh",
    "rollback_command": "sudo {{ backup_dir }}/rollback/rollback-execute.sh {{ rollback_timestamp }}",
    "verification_steps": [
      "Check service status: docker ps",
      "Verify network connectivity: ping 8.8.8.8",
      "Check service health: {{ docker_dir }}/orchestration/health-check.sh",
      "Review logs: tail -f {{ logs_dir }}/deployment.log"
    ]
  }
} 