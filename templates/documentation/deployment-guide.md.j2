# Homelab Deployment Guide

## Overview
This guide provides comprehensive instructions for deploying the Ansible homelab automation system.

## Prerequisites

### System Requirements
- **OS**: Ubuntu 20.04+ or Debian 11+
- **CPU**: 4+ cores recommended
- **RAM**: 8GB+ recommended
- **Storage**: 100GB+ available space
- **Network**: Static IP address

### Software Requirements
- Python 3.8+
- Ansible 2.12+
- Docker 20.10+
- Docker Compose 2.0+

## Installation Steps

### 1. Clone Repository
```bash
git clone https://github.com/your-repo/ansible_homelab.git
cd ansible_homelab
```

### 2. Setup Environment
```bash
# Create environment file
cp .env.example .env

# Edit environment variables
nano .env
```

### 3. Configure Vault
```bash
# Create vault file
ansible-vault create group_vars/all/vault.yml

# Add required secrets
ansible-vault edit group_vars/all/vault.yml
```

### 4. Run Deployment
```bash
# Test deployment
ansible-playbook site.yml --check

# Execute deployment
ansible-playbook site.yml
```

## Configuration

### Core Variables
- `domain`: Your domain name
- `docker_dir`: Docker data directory
- `data_dir`: Application data directory
- `backup_dir`: Backup storage directory

### Service Configuration
Each service can be enabled/disabled in `group_vars/all/roles.yml`:

```yaml
security_enabled: true
databases_enabled: true
media_enabled: true
# ... other services
```

## Verification

### Health Checks
```bash
# Check service status
docker ps

# Run health checks
{{ docker_dir }}/orchestration/health-check.sh

# Check monitoring
curl http://localhost:3000  # Grafana
curl http://localhost:9090  # Prometheus
```

### Access URLs
- **Grafana**: https://grafana.{{ domain }}
- **Prometheus**: https://prometheus.{{ domain }}
- **Traefik**: https://traefik.{{ domain }}
- **Authentik**: https://auth.{{ domain }}

## Troubleshooting

### Common Issues
1. **Port conflicts**: Check for existing services on required ports
2. **Permission errors**: Ensure proper file permissions
3. **Network issues**: Verify firewall and DNS configuration

### Logs
```bash
# View deployment logs
tail -f {{ logs_dir }}/deployment.log

# View service logs
docker logs <service_name>

# View system logs
journalctl -u docker
```

## Maintenance

### Updates
```bash
# Update services
ansible-playbook site.yml --tags update

# Update system
ansible-playbook site.yml --tags system-update
```

### Backups
```bash
# Manual backup
{{ docker_dir }}/backup/orchestration/backup-orchestrator.sh

# Check backup status
ls -la {{ backup_dir }}
```

## Security

### Access Control
- Use Authentik for SSO
- Enable 2FA where possible
- Regular password rotation
- Network segmentation

### Monitoring
- Prometheus metrics collection
- Grafana dashboards
- AlertManager notifications
- Security event logging

## Support

For issues and questions:
- Check the troubleshooting guide
- Review service documentation
- Open an issue on GitHub
- Contact the maintainers 