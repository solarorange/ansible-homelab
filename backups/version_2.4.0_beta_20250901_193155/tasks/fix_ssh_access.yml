---
# Emergency SSH Access Fix
# This task restores SSH access that may have been blocked by firewall rules

- name: Emergency SSH access restoration
  hosts: all
  become: yes
  gather_facts: no
  
  tasks:
    - name: Temporarily disable UFW to restore access
      community.general.ufw:
        state: disabled
      ignore_errors: yes

    - name: Allow SSH access from any source
      community.general.ufw:
        rule: allow
        port: "22"
        proto: tcp
        from: any
        comment: "Emergency SSH access"

    - name: Enable UFW with SSH access
      community.general.ufw:
        state: enabled
        logging: on

    - name: Verify SSH port is accessible
      ansible.builtin.wait_for:
        port: 22
        timeout: 30
      delegate_to: localhost

