# Secret Rotation Report
# Generated: {{ report_timestamp }}

## Rotation Summary
- Host: {{ inventory_hostname }}
- Rotation performed: {{ rotation_performed }}
- Timestamp: {{ report_timestamp }}
- User: {{ ansible_user }}

## Configuration
- Rotation enabled: {{ secret_rotation.enabled }}
- Rotation interval: {{ secret_rotation.rotation_interval_days }} days
- Backup old secrets: {{ secret_rotation.backup_old_secrets }}
- Force rotation: {{ secret_rotation.force_rotation }}

## Rotation Details
{% if rotation_performed %}
### Secrets Rotated
- Database passwords (PostgreSQL, Redis, Media DB, Paperless DB)
- Service admin passwords (Grafana, Authentik, Portainer, GitLab)
- API keys (Sonarr, Radarr, Lidarr, Readarr, Prowlarr, Bazarr)
- Secret keys (Authentik, Grafana, Paperless, Immich JWT)

### Services Restarted
- Database services (PostgreSQL, Redis, MariaDB)
- Authentication services (Authentik, Grafana, Portainer)
- Media services (Sonarr, Radarr, Lidarr, Readarr, Prowlarr, Bazarr)

### Backup Information
- Backup location: {{ backup_dir }}/secrets/{{ ansible_date_time.date }}/
- Backup timestamp: {{ ansible_date_time.iso8601 }}
- Backup contents:
  - Vault file backup
  - Environment variables backup

### Next Rotation
- Next rotation date: {{ ((ansible_date_time.epoch | int) + (secret_rotation.rotation_interval_days * 86400)) | strftime('%Y-%m-%d %H:%M:%S') }}
- Days until next rotation: {{ secret_rotation.rotation_interval_days }}

{% else %}
### No Rotation Performed
- Reason: Rotation not due or disabled
- Days since last rotation: {{ days_since_rotation }}
- Next rotation due: {{ ((ansible_date_time.epoch | int) + (secret_rotation.rotation_interval_days * 86400)) | strftime('%Y-%m-%d %H:%M:%S') }}
{% endif %}

## Security Notes
1. All new secrets are cryptographically secure
2. Old secrets are backed up before rotation
3. Services are restarted to apply new secrets
4. Rotation history is maintained for audit purposes

## Recommendations
{% if rotation_performed %}
1. **Immediate Actions:**
   - Verify all services are running correctly
   - Test authentication for all services
   - Update any external integrations with new API keys
   - Review logs for any authentication errors

2. **Follow-up Actions:**
   - Update documentation with new credentials
   - Notify team members of credential changes
   - Test backup and recovery procedures
   - Review access logs for any failed authentication attempts

3. **Security Enhancements:**
   - Consider implementing automated credential testing
   - Review and update access control policies
   - Implement additional monitoring for authentication failures
{% else %}
1. **Maintenance Actions:**
   - Review current secret age and security policies
   - Consider manual rotation if security concerns exist
   - Update rotation schedule if needed
   - Review backup and recovery procedures

2. **Security Review:**
   - Audit current secret usage and access patterns
   - Review authentication logs for suspicious activity
   - Verify backup integrity and accessibility
{% endif %}

## Audit Trail
- Rotation initiated by: {{ ansible_user }}
- Ansible version: {{ ansible_version.full }}
- Playbook: {{ ansible_playbook_name }}
- Task: secret_rotation

---
Report generated by Ansible Homelab Secret Rotation 