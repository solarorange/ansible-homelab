---
# Gluetun Monitoring Tasks

- name: Configure Gluetun monitoring
  template:
    src: monitoring.yml.j2
    dest: "{{ prometheus_config_dir }}/gluetun.yml"
    mode: '0644'
  notify: reload prometheus
  tags: [gluetun, monitoring]

- name: Setup Gluetun metrics collection
  uri:
    url: "https://{{ gluetun_domain }}/api/admin/monitoring"
    method: PUT
    headers:
      Content-Type: "application/json"
      Authorization: "Bearer {{ vault_gluetun_api_key | default('') }}"
    body_format: json
    body:
      enabled: "{{ gluetun_metrics_enabled | lower }}"
      port: "{{ gluetun_metrics_port }}"
  tags: [gluetun, monitoring]
