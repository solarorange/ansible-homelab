#!/bin/bash
# Gluetun Backup Script

BACKUP_DIR="{{ backup_dir }}/gluetun"
DATE=$(date +%Y%m%d_%H%M%S)

mkdir -p "$BACKUP_DIR"

# Backup data directory
if [ -d "{{ docker_data_root }}/gluetun" ]; then
    tar -czf "$BACKUP_DIR/data_$DATE.tar.gz" -C "{{ docker_data_root }}" gluetun
fi

# Backup config directory
if [ -d "{{ docker_config_root }}/gluetun" ]; then
    tar -czf "$BACKUP_DIR/config_$DATE.tar.gz" -C "{{ docker_config_root }}" gluetun
fi

# Cleanup old backups
find "$BACKUP_DIR" -name "*.tar.gz" -mtime +{{ gluetun_backup_retention_days | default(30) }} -delete
