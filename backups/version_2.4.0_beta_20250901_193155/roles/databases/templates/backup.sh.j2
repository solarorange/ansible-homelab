#!/bin/bash
# PostgreSQL Backup Script with PITR
BACKUP_DIR="{{ docker_dir }}/postgresql/backup"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)
BACKUP_FILE="$BACKUP_DIR/postgresql_backup_$TIMESTAMP.sql.gz"
mkdir -p "$BACKUP_DIR"
docker exec {{ postgresql_container_name }} pg_dumpall -U {{ postgresql_admin_user }} | gzip > "$BACKUP_FILE"
find "$BACKUP_DIR" -name "postgresql_backup_*.sql.gz" -mtime +7 -delete
echo "Backup created: $BACKUP_FILE" 