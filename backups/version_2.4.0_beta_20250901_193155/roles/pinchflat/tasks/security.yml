---
# Pinchflat Security Tasks

- name: Configure Pinchflat security headers
  uri:
    url: "https://{{ pinchflat_domain }}/api/admin/security/headers"
    method: PUT
    headers:
      Content-Type: "application/json"
      Authorization: "Bearer {{ vault_pinchflat_api_key | default('') }}"
    body_format: json
    body:
      enabled: "{{ pinchflat_security_headers | lower }}"
  tags: [pinchflat, security]

- name: Configure Pinchflat rate limiting
  uri:
    url: "https://{{ pinchflat_domain }}/api/admin/security/rate-limit"
    method: PUT
    headers:
      Content-Type: "application/json"
      Authorization: "Bearer {{ vault_pinchflat_api_key | default('') }}"
    body_format: json
    body:
      enabled: "{{ pinchflat_rate_limiting | lower }}"
      requests: "{{ pinchflat_rate_limit_requests }}"
      window: "{{ pinchflat_rate_limit_window }}"
  tags: [pinchflat, security]

- name: Configure Pinchflat CORS
  uri:
    url: "https://{{ pinchflat_domain }}/api/admin/security/cors"
    method: PUT
    headers:
      Content-Type: "application/json"
      Authorization: "Bearer {{ vault_pinchflat_api_key | default('') }}"
    body_format: json
    body:
      enabled: "{{ pinchflat_cors_enabled | lower }}"
  tags: [pinchflat, security]
